# version 1
~~~txt
현재 프로젝트는 mybatis 기반의 프로젝트 입니다.
다음과 같이 데이터베이스 및 테이블 정보를 표 형식 으로 정리하여 markdown 파일로 저장해주세요.
  1. 대상 엔드포인트
  2. 엔드포인트 주석내용 요약(한글로 출력)
  3. 컨트롤러 명
  4. 데이터베이스
  5. 테이블

- 추가 요청 사항
  - 만약 내용이 없을 경우 "존재하지 않음" 으로 출력 해주세요.  
~~~

# version 2
~~~txt
현재 프로젝트는 mybatis 기반의 프로젝트 입니다.
프로젝트를 분석하고 다음과 같이 표 형식으로 정리하여 모든 내용을 markdown 형식의 파일로 저장해주세요.
입출력 내용이 많을 경우 나눠서 수행하세요. 나눠서 수행시 저에게 수행 여부를 'Y' | 'N' 으로 문의 하시면 됩니다.

#지침
  - 파일명 : "프로젝트 명"-db-table.md
  - 표 형식
    - 표 제목 : "프로젝트 명"
    - 표 내용
      1.대상 API 엔드포인트
      2.주석 내용 요약(한글로 출력)
      3.컨트롤러 명
      4.데이터베이스
      5.테이블
    - 표 예시
    | 대상 엔드포인트                       | 주석 내용 요약                                                                  | 컨트롤러 명             | 데이터베이스 명 | 테이블                |
|--------------------------------|---------------------------------------------------------------------------|--------------------|----------|--------------------|
| /acctmng/bankAcnt/giveVirtAcnt | 1. 고객별 가상계좌번호 조회 ( TINAMTBANK--입금은행, TVIRTUALACNT --가상계좌 ) 2. 무통장 입금 계좌생성 | BankAcntController | ADM      | TB_VIRTUAL_ACCOUNT |

  - 추가 요청 사항
    - 만약 데이터베이스 관련 내용이 없을 경우 "N/A" 으로 출력 해주세요.
~~~



----

# version 3, 프롬프트 개선

## 1단계: 분석 시작 및 Mapper 목록 전달
* 사용자 준비사항: 프로젝트 최상위 경로에서 다음 명령어를 실행하여 결과를 복사

~~~bash
find . -name "*Mapper.xml"
~~~


* Gemini 프롬프트: (아래 내용을 복사하여 Gemini CLI에 입력)

~~~txt
지금부터 mybatis 기반의 "[프로젝트 명]" 프로젝트에 대한 데이터베이스 사용 내역 분석을 시작하겠습니다. 이 작업은 여러 단계에 걸쳐 진행되며, 제가 단계별로 정보를 제공할 것입니다.

최종 목표는 각 API 엔드포인트가 어떤 데이터베이스 테이블을 사용하는지 분석하여 마크다운 표로 정리하는 것입니다.

먼저, 분석할 전체 Mapper XML 파일 목록은 다음과 같습니다. 이 목록을 기억하고 있다가, 제가 각 파일의 내용을 제공하면 분석을 시작해주세요.

# 분석 대상 Mapper XML 파일 목록
[find . -name "*Mapper.xml" 실행 결과를 여기에 붙여넣으세요.]

목록을 확인했으면, 목록의 첫 번째 파일인 "[목록 중 첫 번째 파일의 전체 경로]" 파일의 내용을 입력하라고 요청해주세요.
~~~


## 2단계: Mapper XML 파일 내용 분석 (파일 개수만큼 반복)

* 사용자 준비사항: Gemini가 요청하는 파일의 내용을 터미널에서 cat [파일 경로] 명령으로 확인하여 복사해두세요.
* Gemini 프롬프트: (Gemini가 파일 내용을 요청하면 아래 형식으로 입력)

~~~txt
네, 요청하신 "[파일 경로]" 파일의 내용을 전달합니다.
이 파일에서 각 `<select>`, `<insert>`, `<update>`, `<delete>` 태그의 `id` 값과, 해당 SQL문에서 사용된 테이블 명을 추출하여 모두 기억해주세요.
분석이 끝나면 다음 파일을 요청해주세요.

# 파일 내용: [파일 경로]
'''xml
[cat [파일 경로] 실행 결과를 여기에 붙여넣으세요.]
'''
~~~

* 사용자 가이드: 1단계에서 제공한 모든 Mapper 파일 목록에 대해 이 과정을 반복합니다. Gemini가 다음 파일명을 알려주면 그 파일의 내용을 위 형식에 맞춰 계속 입력해주세요.


## 3단계: Controller 파일 분석 (파일 개수만큼 반복)

* 사용자 준비사항:
  1. 프로젝트 최상위 경로에서 find . -name "*Controller.java" 명령을 실행하여 Controller 파일 목록을 확인합니다.
  2. Mapper 분석이 모두 끝났음을 알리고, 첫 번째 Controller 파일의 내용을 cat 명령으로 복사해둡니다.
* Gemini 프롬프트: (모든 Mapper 분석이 끝난 후, 아래 내용을 입력)

~~~txt
모든 Mapper XML 파일 분석이 완료되었습니다. 이제부터는 이 쿼리들을 호출하는 Controller를 분석하여 API 엔드포인트와 연결하겠습니다.

첫 번째 Controller 파일인 "[첫 번째 Controller 파일 경로]"의 내용을 제공할테니 분석해주세요.

# 분석 요청 지침
1. 각 메소드의 `@GetMapping`, `@PostMapping` 등 어노테이션에서 API 엔드포인트 경로를 추출하세요.
2. 메소드 상단의 JavaDoc 주석(`/** */`) 내용을 요약하세요.
3. 메소드 내부에서 호출하는 Service 또는 Mapper의 메소드 명을 확인하세요. (이 정보는 앞서 분석한 쿼리 ID와 연결하는 데 사용됩니다.)

분석이 끝나면 다음 Controller 파일을 요청해주세요.

# 파일 내용: [첫 번째 Controller 파일 경로]
'''java
[cat [첫 번째 Controller 파일 경로] 실행 결과를 여기에 붙여넣으세요.]
'''
~~~

* 사용자 가이드: 2단계와 마찬가지로, 모든 Controller 파일에 대해 이 과정을 반복합니다.



## 4단계: 최종 결과물 생성 요청

* 사용자 준비사항: 모든 정보 제공이 완료되었으므로, 마지막으로 결과 생성을 요청합니다.
* Gemini 프롬프트: (모든 Controller 분석이 끝난 후, 아래 내용을 입력)

~~~txt
모든 Controller 파일 분석이 완료되었습니다.
지금까지 제공된 모든 Mapper와 Controller 정보를 종합하여, 최종 분석 결과를 아래 지침에 따라 마크다운 표 형식의 텍스트로 생성해주세요.

# 최종 결과물 지침
- 표 제목: `[프로젝트 명] 데이터베이스 사용 내역`
- 표 컬럼:
  1. `대상 엔드포인트 또는 서비스명`
  2. `주석 내용 요약 (한글)`
  3. `컨트롤러 명`
  4. `데이터베이스` (알 수 없는 경우 'N/A'로 표기)
  5. `테이블`
- 추가 요청 사항:
  - 컨트롤러와 직접 연결되지 않았지만 DB를 사용하는 중요 서비스 메소드는 `대상 엔드포인트 또는 서비스명`에 서비스명을 기입해주세요.
  - DB를 사용하지 않는 엔드포인트는 결과에서 제외해주세요.
  - 하나의 엔드포인트가 여러 테이블을 사용하면, 테이블 이름만 여러 줄로 나누어 보기 좋게 표시해주세요.
  - 최종 결과물은 제가 파일로 바로 저장할 수 있도록, 다른 설명 없이 마크다운 코드만 출력해주세요.
~~~

* 사용자 최종 작업: Gemini가 출력한 마크다운 텍스트를 복사하여, 원하는 위치에 [프로젝트 명]-db-tabel.md 파일로 저장합니다. CLI의 출력 리디렉션 기능을 사용하면 더 편리합니다.

~~~bash
gemini prompt "위의 4단계 프롬프트 내용" > /Users/cjenm/work/msa/[프로젝트 명]-db-tabel.md

~~~





2025-08-01
~~~txt
"analyze_db_usage.sh" 다음의 shell script 는 Gemini CLI 프롬프트를 이용하여, 프로젝트를 분석하는 script 입니다.
목적은 myBatis 기반 프로젝트 내에서 엔드포인트 별로 데이터베이스 / 테이블 등의 관계를 분석하고, 이를 마크다운으로 정리하는 프롬프트 입니다.

다음의 shell script를 개선하고자 합니다.
* 최종 보고서의 형식을 표 형식으로 수정
* 표에 엔드포인트 주석내용 컬럼 및 내용 추가
  * 주석 내용을 있을 경우 한글로 출력
  * 주석 내용이 없을 경우 "N/A" 로 출력
~~~


~~~
    "mcp-atlassian": {
      "command": "docker",
      "args": [
        "run",
        "-i",
        "--rm",
        "-e", "CONFLUENCE_URL",
        "-e", "CONFLUENCE_USERNAME",
        "-e", "CONFLUENCE_API_TOKEN",
        "ghcr.io/sooperset/mcp-atlassian:latest"
      ],
      "env": {
        "CONFLUENCE_URL": "https://cjics.cj.net/confluence/",
        "CONFLUENCE_USERNAME": "yeochul.jeon@cj.net",
        "CONFLUENCE_API_TOKEN": "OTQzMTYzNjA4ODkwOs2ouGJ0LtlNao/ls6ukzGgzclNS"
      }
    }
~~~